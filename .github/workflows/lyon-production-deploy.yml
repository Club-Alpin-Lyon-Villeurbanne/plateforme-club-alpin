name: Deploy on Production - Lyon üöÄ

on:
  push:
    branches:
      - production
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  deploy:
    uses: ./.github/workflows/deploy-clevercloud.yml
    with:
      environment: production
      deployment_label: Production - Lyon
      clever_app_id: ${{ vars.LYON_CLEVER_APP_ID }}
      last_deployed_variable: LYON_LAST_DEPLOYED_SHA
      failure_logs_url: ${{ vars.LYON_FAILURE_LOGS_URL }}
    secrets:
      # ‚ö†Ô∏è TOKEN PARTAG√â - Un seul token pour TOUS les clubs (Lyon, Chamb√©ry, Clermont, etc.)
      # Token nominatif qui expire apr√®s 1 AN - Renouveler AVANT expiration
      # Si le d√©tenteur quitte le projet, renouveler IMM√âDIATEMENT
      clever_token: ${{ secrets.CLEVER_TOKEN }}
      clever_secret: ${{ secrets.CLEVER_SECRET }}
      slack_webhook: ${{ secrets.SLACK_WEBHOOK_URL }}
