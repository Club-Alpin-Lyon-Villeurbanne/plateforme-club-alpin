services:
  cafsite:
    build:
      cache_from:
        - type=registry,ref=quay.io/caf/php:build_composer
        - type=registry,ref=quay.io/caf/php:build_installer
        - type=registry,ref=quay.io/caf/php:build_phive
        - type=registry,ref=quay.io/caf/php:latest
      context: ./docker
      args:
        - UID=${UID_OVERRIDE:-${UID:-1000}}
        - GID=${GID_OVERRIDE:-${GID:-1000}}
    container_name: www_caflyon
    ports:
      - "8000:80"
    volumes:
      - ./docker/vhosts:/etc/apache2/sites-enabled
      - ./docker/utils/xdebug.ini:/usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini
      - ./:/var/www

  cafdb:
    image: mysql:5.7
    container_name: db_caflyon
    environment:
      MYSQL_ROOT_PASSWORD: ${DB_PASSWORD}
      MYSQL_DATABASE: ${DB_NAME}
    restart: always
    volumes:
      - ./db:/var/lib/mysql

  phpmyadmin:
    image: phpmyadmin
    container_name: phpmyadmin_caflyon
    ports:
      - 8080:80
    environment:
      PMA_HOST: ${DB_HOST}
      UPLOAD_LIMIT: ${UPLOAD_LIMIT}

  mailcatcher:
    image: schickling/mailcatcher
    container_name: mail_caflyon
    ports:
      - 1081:1080
