{% extends 'base.html.twig' %}

{% block title %}{{ title }}{% endblock %}

{% block body %}
    <div id="form-event">
        <h1 class="page-h1">{{ title }}</h1>

        {% import 'macros/form_macros.html.twig' as form_macros %}
        {% form_theme form 'form/encadrants_checkbox_theme.html.twig' %}

        {{ form_start(form, {
            attr: {class: 'padded-form'}
        }) }}

        {% if isUpdate and event.status is same as (1) %}
            <p class="alerte">Attention : si vous modifiez cette sortie, elle devra à nouveau être validée par un responsable avant d'être affichée sur le site !</p><br />
        {% endif %}

        <div style="width:45%; padding-right:3%; float:left">
            {% if isUpdate %}
                Sortie liée à la commission :<br />
                <b>{{ commission }}</b>
            {% else %}
                {{ form_row(form.commission) }}
            {% endif %}
        </div>
        <div style="width:50%; float:left" id="groupe">
            {{ form_macros.display_group_form_field(form.groupe) }}
        </div>
        <br style="clear:both" />

        <div id="individus">
            {{ form_macros.display_encadrement(form, isUpdate) }}
        </div>

        <h2 class="clear trigger-h2">Informations :</h2>
        <div class="trigger-me">
            {{ form_row(form.titre) }}<br />
            {{ form_row(form.massif) }}<br />

            {{ form_row(form.rdv) }}<br />
            {{ form_row(form.lat) }}
            {{ form_row(form.long) }}
            <div id="suggestions"></div>
            <br style="clear:both" />

            <div style="width:45%; padding-right:3%; float:left">
                {{ form_row(form.eventStartDate) }}
            </div>
            <div style="width:50%; float:left">
                {{ form_row(form.eventEndDate) }}
            </div>
            <br style="clear:both" />
        </div>

        <h2 class="trigger-h2">Inscriptions :</h2>
        <div class="trigger-me">
            <div style="width:45%; padding-right:3%; float:left">
                <div>
                    {{ form_label(form.ngensMax) }}
                    {{ form_widget(form.ngensMax) }} {{ form_help(form.ngensMax) }}
                </div><br />
            </div>
            <div style="width:50%; float:left">
                {{ form_row(form.joinMax) }}
            </div>
            <br style="clear:both" /><br />
            {{ form_row(form.joinStartDate) }}
        </div>

        <h2 class="trigger-h2">Description complète <span class="required">*</span> :</h2>
        <div class="trigger-me">
            <p>
                Entrez ci-dessous toutes les informations qui ne figurent pas dans le formulaire.
                N'hésitez pas à mettre un maximum<br>de détails, cet élément formera le corps de la page dédiée à cette sortie.
            </p>
            <p>
                <b>Attention :</b><br />Si vous copiez-collez du texte depuis un site, ou un document Word, cochez le bouton <img src="/img/texte-brut.png" title="Coller en tant que texte brut" alt="T" />
                avant de coller votre contenu. Sinon vous risquez de provoquer des erreurs sur la page.
            </p>
            <p>
                <b>Des liens et des images :</b><br />
                Utilisez le bouton <img src="/img/button-link.png" title="" alt="" /> puis <img src="/img/button-parcourir.png" title="" alt="" /> pour ajouter un fichier à télécharger (topo, tracé gps...).<br />
                Utilisez le bouton <img src="/img/button-img.png" title="" alt="" /> puis <img src="/img/button-parcourir.png" title="" alt="" /> pour ajouter une image.<br />
            </p><br />
            {{ form_row(form.description) }}
        </div>

        <h2 class="trigger-h2">Tarif :</h2>
        <div class="trigger-me">
            <div>
                {{ form_label(form.tarif) }}
                {{ form_widget(form.tarif) }} €<br />
                {{ form_help(form.tarif) }}
            </div><br />
            {{ form_row(form.tarifDetail) }}
        </div>

        <h2 class="trigger-h2">Difficulté / matériel :</h2>
        <div class="trigger-me">
            {{ form_row(form.difficulte) }}<br />
            <div>
                {{ form_label(form.denivele) }}
                {{ form_widget(form.denivele) }} m
            </div><br />
            <div>
                {{ form_label(form.distance) }}
                {{ form_widget(form.distance) }} km
            </div><br />
            <div style="float:right; padding-right:20px;">
                {{ form_widget(form.stuff_list) }} <input type="button" value="appliquer" class="nice" id="predefinitions-matos-submit" />
            </div>
            {{ form_row(form.matos) }}
        </div>

        <h2 class="trigger-h2">Itinéraire :</h2>
        <div class="trigger-me">
            {{ form_row(form.itineraire) }}
        </div>

        <h2 class="trigger-h2">Détails pratiques (partie invisible aux adhérents non connectés) :</h2>
        <div class="trigger-me">
            {{ form_row(form.details_caches) }}
        </div>
        <br /><br />

        <div style="text-align:center">
            {{ form_widget(form.eventSave) }}
        </div>

        <div class="hidden">
            {{ form_end(form) }}
        </div>

        <br class="clear" /><br /><br /><br />
    </div>
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {{ vite_entry_link_tags('autocomplete_address') }}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {{ vite_entry_script_tags('participants') }}
    {{ vite_entry_script_tags('commission_switch') }}
    {{ vite_entry_script_tags('autocomplete_address') }}
    <script language="javascript" type="text/javascript" src="/tools/tinymce/tiny_mce.js"></script>
    <script language="javascript" type="text/javascript" src="/js/jquery.webkitresize.min.js"></script>
    <script type="text/javascript">
        // au chargement complet de la page
        document.addEventListener('DOMContentLoaded', function () {
            // liste matériel
            document.querySelector('#predefinitions-matos-submit').addEventListener('click', (e) => {
                const textarea = document.querySelector('#event_matos');
                const select = document.querySelector('#event_stuff_list');
                let replaceContent = true;

                if (textarea.value !== '') {
                    replaceContent = confirm('Ceci va effacer le contenu actuel du champ "Matériel nécessaire". Continuer ?');
                }
                if (replaceContent) {
                    textarea.value = select.value.replace(/\*/g, "\n");
                }
            });

            // refresh au changement de commisssion
            document.querySelector('#event_commission').addEventListener('change', (e) => {
                // groupe et participants selon la commission choisie
                switchCommission(document);
            });

            // champ description pas obligatoire en js
            const contentField = document.getElementById('{{ form.description.vars.id }}');
            if (contentField) {
                contentField.removeAttribute('required');
            }
        });
    </script>
    <script language="javascript" type="text/javascript">
        tinyMCE.init({
            init_instance_callback: function() {
                $(".mceIframeContainer iframe").webkitimageresize().webkittableresize().webkittdresize();
            },

            height: 500,
            theme: "advanced",
            mode: "exact",
            language: "fr",
            elements: "event_description",
            entity_encoding: "raw",
            plugins: "safari,spellchecker,style,layer,table,save,advhr,advimage,advlink,iespell,inlinepopups,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template,pagebreak",
            remove_linebreaks: false,
            file_browser_callback: 'userfilebrowser',

            theme_advanced_buttons1: "newdocument,|,bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,styleselect,formatselect,|,removeformat,cleanup,code",
            theme_advanced_buttons2: "undo,redo,|,cut,copy,paste,pastetext,|,bullist,numlist,|,link,unlink,image,media,|,charmap,sub,sup",
            theme_advanced_buttons3: "tablecontrols,|,hr,visualaid,|,fullscreen",

            theme_advanced_toolbar_location : "top",
            theme_advanced_toolbar_align : "left",
            theme_advanced_statusbar_location : "none",
            theme_advanced_resizing : true,

            document_base_url: '{{ url('legacy_root') }}',

            content_css: "{{ url('legacy_root') }}css/base.css,{{ url('legacy_root') }}css/style1.css,{{ url('legacy_root') }}fonts/stylesheet.css",
            body_id: "bodytinymce_user",
            body_class: "description_evt",
            theme_advanced_styles: "Entete Article=ArticleEntete;Titre de menu=menutitle;Bleu clair du CAF=bleucaf;Image flottante gauche=imgFloatLeft;Image flottante droite=imgFloatRight;Lien fancybox=fancybox;Mini=mini;Bloc alerte=erreur;Bloc info=info",

            relative_urls: true,
            convert_urls: false,
            remove_script_host: false,
            theme_advanced_blockformats: "p,h3,h4,h5,ul,li",

            theme_advanced_resize_horizontal: false,
            theme_advanced_resizing: true,
            apply_source_formatting: true,
            spellchecker_languages: "+English=en,Danish=da,Dutch=nl,Finnish=fi,French=fr,German=de,Italian=it,Polish=pl,Portuguese=pt,Spanish=es,Swedish=sv"
        });

        function userfilebrowser(field_name, url, type, win) {
            tinyMCE.activeEditor.windowManager.open({
                file: 'includes/user-file-browser.php?type=' + type,
                title: 'Mini-File Browser',
                width: 800, // Your dimensions may differ - toy around with them!
                height: 500,
                resizable: "yes",
                inline: "yes", // This parameter only has an effect if you use the inlinepopups plugin!
                close_previous: "no"
            }, {
                window: win,
                input: field_name
            });

            return false;
        }
    </script>
{% endblock %}
