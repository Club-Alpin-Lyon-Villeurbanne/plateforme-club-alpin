{% macro event_line(event, user = null, include_name = '', display_additionnal = true, exp_status = null, action = null, display_participation_status = true) %}
    {% if user is same as(null) %}
        {% set user = app.user %}
    {% endif %}
    <tr>
        <td class="agenda-gauche">
            {% set start = event.startDate | date('d/m/Y') | capitalize %}
            {% set end = event.endDate | date('d/m/Y') | capitalize %}

            {% if start == end %}
                Le {{ start }}<br />
                √† {{ event.startDate | intldate('HH:mm') }}
            {% else %}
                Du {{ start }}<br/>
                au {{ end }}
            {% endif %}

            {% if app.user == event.user and display_additionnal %}
                {% if event.isDraft %}
                    <p class="draft">Brouillon (non publi√©e)</p>
                {% elseif event.status == constant('App\\Entity\\Evt::STATUS_PUBLISHED_UNSEEN') %}
                    <p class="waiting">En attente d'approbation</p>
                {% elseif event.statusLegal == constant('App\\Entity\\Evt::STATUS_LEGAL_VALIDE') %}
                    <p class="info">Publi√©e et valid√©e par le pr√©sident</p>
                {% elseif event.status == constant('App\\Entity\\Evt::STATUS_PUBLISHED_VALIDE') %}
                    <p class="alerte">Publi√©e non valid√©e par le pr√©sident</p>
                {% elseif event.status == constant('App\\Entity\\Evt::STATUS_PUBLISHED_REFUSE') %}
                    <p class="erreur">Sortie refus√©e (non publi√©e)</p>
                {% endif %}
            {% endif %}
        </td>
        <td>
            <div class="evt-tools">
                <a class="nice2" href="{{ path('sortie', { code: event.code, id: event.id }) }}?forceshow=true" title="Ouvre une nouvelle fen√™tre de votre navigateur pour jeter un oeil √† la sortie" target="_blank">
                    Aper√ßu{% if action is same as ('validation') %} / validation de la page{% endif %}
                </a>

                {% if action is same as ('approbation') %}
                    <form action="{{ path('sortie_validate', { id: event.id }) }}" method="post" style="display:inline" class="loading">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token('sortie_validate') }}" />
                        <input type="submit" value="Approuver &amp; publier" class="nice2 green" title="Approuve instantan√©ment la sortie et la publie" />
                    </form>

                    <input type="button" value="Refuser" class="nice2 red" onclick="modal.show($(this).next().html())" title="Refuser cette sortie. Vous devrez ajouter un message √† l'organisateur de la sortie." />
                    <div style="display:none" id="refuser-{{ event.id }}">
                        <form action="{{ path('sortie_refus', { id: event.id }) }}" method="post" class="loading">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token('sortie_refus') }}" />

                            <p>Laissez un message √† l'organisateur pour lui expliquer la raison du refus :</p>
                            <input type="text" name="msg" class="type1" placeholder="ex: Mauvais point de RDV" />
                            <input type="submit" value="Refuser la sortie" class="nice2 red" />
                            <input type="button" value="Annuler" class="nice2" onclick="$.fancybox.close()" />
                        </form>
                    </div>
                    {% if is_granted('SORTIE_DELETE', event) %}
                        <a class="nice2 noprint red" onclick="modal.show($(this).next().html())" title="Supprimer d√©finitivement cette sortie"><img src="/img/base/x2.png" alt="" title="" style="" />&nbsp;&nbsp;Supprimer d√©finitivement cette sortie</a>
                        <div style="display:none" id="supprimer-{{ event.id }}">
                            <h2>Supprimer d√©finitivement la sortie</h2>
                            <p>
                                Voulez-vous vraiment supprimer d√©finitivement cette sortie ?<br>
                                Cette action supprimera d√©finitivement la sortie et les fichiers li√©s.<br>
                                <strong>Attention</strong> : vous ne devriez jamais supprimer une sortie qui a √©t√© publi√©e sur le site car la conserver permet d'√©tablir des statistiques, et l'URL de la page d√©di√©e √† cette sortie retournera une erreur 404 si des utilisateurs souhaitent y retourner.
                            </p>
                            {% if event.publicStatusValide %}
                                <p class="alerte">Cette sortie est publi√©e sur le site. En la supprimant, vous cr√©erez une page introuvable.</p>
                            {% else %}
                                <p class="info">Cette sortie n'est pas publi√©e sur le site. Vous pouvez la supprimer sereinement.</p>
                            {% endif %}
                            <form action="{{ path('delete_event', { id: event.id }) }}" method="post" class="loading">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token('delete_event') }}" />
                                <input type="submit" value="Supprimer d√©finitivement cette sortie" class="nice2 noprint red" title="Supprimer d√©finitivement cette sortie" />
                            </form>
                        </div>
                    {% endif %}
                {% endif %}
            </div>

            <a class="agenda-evt-debut" target="_top" href="{{ path('sortie', { code: event.code, id: event.id }) }}?commission={{ event.commission.code }}" title="">

                <!-- picto -->
                <div class="picto">
                    <img src="{{ commission_picto(event.commission.code) }}" alt="" title="" class="picto-light" />
                    <img src="{{ commission_picto(event.commission.code, 'dark') }}" alt="" title="" class="picto-dark" />
                </div>

                <div class="temoin" title="{{ event | temoin_event_title }}">
                    <span class="temoin-places-dispos"> {{ event | temoin_event_picto }}</span>
                </div>

                <div class="droite">

                    <h2 class="tw-flex tw-items-center tw-gap-2">
                        {% if event.cancelled %}<span style="padding:1px 3px; color:red; font-family:Arial;white-space: nowrap;">ANNUL√âE - </span>{% endif %}
                        {{ event.titre }}

                        {% set participation = event.participation(user) %}
                        {% if participation and display_participation_status %}
                            <div class="tw-flex tw-flex-col tw-items-end tw-ml-auto">
                                {% set is_orga = false %}
                                {% if app.user == event.user %}
                                    {% set is_orga = true %}
                                {% endif %}

                                {% if participation.status == constant('App\\Entity\\EventParticipation::STATUS_REFUSE') %}
                                    <span class="tw-inline-flex tw-items-center tw-gap-1 tw-text-xs tw-font-medium tw-text-red-600 tw-whitespace-nowrap">
                                        <svg class="tw-w-3 tw-h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                        </svg>
                                        Refus√©
                                    </span>
                                {% elseif participation.status == constant('App\\Entity\\EventParticipation::STATUS_VALIDE') %}
                                    {% if participation.role and participation.role in constant('App\\Entity\\EventParticipation::ROLES_ENCADREMENT') %}
                                        <span class="tw-inline-flex tw-items-center tw-text-right tw-gap-1 tw-text-xs tw-font-medium tw-text-gray-600 tw-whitespace-nowrap">
                                            {% if is_orga %}
                                                ‚úçÔ∏è
                                            {% endif %}
                                            {{ participation.role|trans }}
                                        </span>
                                    {% else %}
                                        <span class="tw-inline-flex tw-items-center tw-gap-1 tw-text-xs tw-font-medium tw-text-green-600 tw-whitespace-nowrap">
                                            <svg class="tw-w-3 tw-h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                            </svg>
                                            Accept√©
                                        </span>
                                    {% endif %}
                                {% elseif participation.status == constant('App\\Entity\\EventParticipation::STATUS_ABSENT') %}
                                    <span class="tw-inline-flex tw-items-center tw-gap-1 tw-text-xs tw-font-medium tw-text-gray-600 tw-whitespace-nowrap">
                                        <svg class="tw-w-3 tw-h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                        Absent
                                    </span>
                                {% else %}
                                    <span class="tw-inline-flex tw-items-center tw-gap-1 tw-text-xs tw-font-medium tw-text-orange-600 tw-whitespace-nowrap">
                                        <svg class="tw-w-3 tw-h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                        En attente
                                    </span>
                                {% endif %}
                            </div>
                        {% endif %}
                    </h2>

                    <p class="tw-flex tw-justify-between tw-items-center">
                        <span>
                            <b>{{ event.commission.title }}</b>
                        </span>
                        {% if participation and display_notes_de_frais and include_name is same as ('profil-sorties-prev')
                            and event.finished and not event.cancelled and event.statusLegal
                            and (participation.role in constant('App\\Entity\\EventParticipation::ROLES_ENCADREMENT')) %}
                            {% if exp_status and exp_status.value == constant('App\\Entity\\ExpenseReport::STATUS_DRAFT') %}
                                <span class="text-din tw-inline-flex tw-items-center tw-text-right tw-gap-1 tw-text-xs tw-font-medium tw-text-orange-600 tw-whitespace-nowrap">
                                    üßæ ‚úç
                                    NdF brouillon
                                </span>
                            {% elseif exp_status and exp_status.value == constant('App\\Entity\\ExpenseReport::STATUS_SUBMITTED') %}
                                <span class="text-din tw-inline-flex tw-items-center tw-text-right tw-gap-1 tw-text-xs tw-font-medium tw-text-orange-600 tw-whitespace-nowrap">
                                    üßæ‚è≥
                                    NdF en v√©rif.
                                </span>
                            {% elseif exp_status and exp_status.value == constant('App\\Entity\\ExpenseReport::STATUS_APPROUVED') %}
                                <span class="text-din tw-inline-flex tw-items-center tw-text-right tw-gap-1 tw-text-xs tw-font-medium tw-text-green-600 tw-whitespace-nowrap">
                                    üßæ üÜó
                                    NdF accept√©e
                                </span>
                            {% elseif exp_status and exp_status.value == constant('App\\Entity\\ExpenseReport::STATUS_ACCOUNTED') %}
                                <span class="text-din tw-inline-flex tw-items-center tw-text-right tw-gap-1 tw-text-xs tw-font-medium tw-text-green-600 tw-whitespace-nowrap">
                                    üßæ ‚úÖ
                                    NdF comptabilis√©e
                                </span>
                            {% elseif exp_status and exp_status.value == constant('App\\Entity\\ExpenseReport::STATUS_REJECTED') %}
                                <span class="text-din tw-inline-flex tw-items-center tw-text-right tw-gap-1 tw-text-xs tw-font-medium tw-text-red-600 tw-whitespace-nowrap">
                                    üßæ ‚ùå
                                    NdF refus√©e
                                </span>
                            {% else %}
                                <span class="text-din tw-inline-flex tw-items-center tw-text-right tw-gap-1 tw-text-xs tw-font-medium tw-text-gray-600 tw-whitespace-nowrap">
                                    üßæ‚ùì
                                    NdF possible
                                </span>
                            {% endif %}
                        {% endif %}
                    </p>
                </div>
                <br style="clear:both" />

            </a>

            {% if participation and participation.status != constant('App\\Entity\\EventParticipation::STATUS_REFUSE') %}
                {% set empietements = empietements(event, user) %}
                {% if empietements | length > 0 and display_additionnal %}
                    <div class="empietements">
                        <b style="margin-left: 20px">Attention au timing :</b>
                        {% for empietement in empietements %}
                            {% if empietement.status == constant('App\\Entity\\EventParticipation::STATUS_NON_CONFIRME') %}
                                <br />- Vous √™tes aussi pr√©-inscrit sur la sortie <a href="{{ path('sortie', {'code': empietement.event.code, 'id': empietement.event.id}) }}" title="">{{ empietement.event.titre }}</a>
                            {% endif %}
                            {% if empietement.status == constant('App\\Entity\\EventParticipation::STATUS_VALIDE') %}
                                <br />- Vous √™tes aussi <span style="color:red">confirm√©</span> sur la sortie <a href="{{ path('sortie', {'code': empietement.event.code, 'id': empietement.event.id}) }}" title="">{{ empietement.event.titre }}</a>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endif %}
            {% endif %}
        </td>
    </tr>
{% endmacro %}
