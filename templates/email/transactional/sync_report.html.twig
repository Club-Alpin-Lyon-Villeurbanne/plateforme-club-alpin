{% extends 'email/transactional/layout.html.twig' %}

{% block subject %}Rapport de synchronisation FFCAM du {{ date }}{% endblock %}

{% block inner_html %}
    <h2>Synchronisation des adh√©rents termin√©e</h2>

    <p>La synchronisation automatique des adh√©rents FFCAM s'est ex√©cut√©e avec succ√®s.</p>

    <h3>üìä R√©sum√© de la synchronisation</h3>

    <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd; background-color: #f8f8f8;">
                <strong>Date d'ex√©cution</strong>
            </td>
            <td style="padding: 10px; border: 1px solid #ddd;">
                {{ startTime|date('d/m/Y √† H:i:s') }}
            </td>
        </tr>
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd; background-color: #f8f8f8;">
                <strong>Dur√©e totale</strong>
            </td>
            <td style="padding: 10px; border: 1px solid #ddd;">
                {{ duration }}
            </td>
        </tr>
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd; background-color: #f8f8f8;">
                <strong>Total trait√©</strong>
            </td>
            <td style="padding: 10px; border: 1px solid #ddd;">
                <strong style="font-size: 1.2em; color: #2da1bf;">{{ total }}</strong> adh√©rent(s)
            </td>
        </tr>
    </table>

    <h3>üìà D√©tail des op√©rations</h3>

    <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd; background-color: #d4f4dd;">
                <strong>‚úÖ Nouveaux adh√©rents</strong>
            </td>
            <td style="padding: 10px; border: 1px solid #ddd; text-align: center; font-size: 1.2em;">
                <strong>{{ stats.inserted }}</strong>
            </td>
        </tr>
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd; background-color: #ffeaa7;">
                <strong>üîÑ Adh√©rents mis √† jour</strong>
            </td>
            <td style="padding: 10px; border: 1px solid #ddd; text-align: center; font-size: 1.2em;">
                <strong>{{ stats.updated }}</strong>
            </td>
        </tr>
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd; background-color: #dfe6e9;">
                <strong>üîó Adh√©rents fusionn√©s</strong>
            </td>
            <td style="padding: 10px; border: 1px solid #ddd; text-align: center; font-size: 1.2em;">
                <strong>{{ stats.merged }}</strong>
            </td>
        </tr>
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd; background-color: #ffcccc;">
                <strong>‚è∞ Adh√©rents avec licence expir√©e</strong>
            </td>
            <td style="padding: 10px; border: 1px solid #ddd; text-align: center; font-size: 1.2em;">
                <strong>{{ stats.blocked|default(0) }}</strong>
            </td>
        </tr>
    </table>

    {% if stats.inserted > 0 %}
    <div style="padding: 15px; background-color: #d4f4dd; border-radius: 5px; margin: 20px 0;">
        <p style="margin: 0;">
            <strong>{{ stats.inserted }} nouveau(x) adh√©rent(s)</strong> ont √©t√© ajout√©s √† la base de donn√©es.
            Ces comptes sont en attente de validation et devront confirmer leur adresse email.
        </p>
    </div>
    {% endif %}

    {% if stats.merged > 0 %}
    <div style="padding: 15px; background-color: #dfe6e9; border-radius: 5px; margin: 20px 0;">
        <p style="margin: 0;">
            <strong>{{ stats.merged }} doublon(s) d√©tect√©(s)</strong> : des adh√©rents existants ont √©t√© trouv√©s
            avec un nouveau num√©ro de licence. Les comptes ont √©t√© fusionn√©s automatiquement.
        </p>
    </div>
    {% endif %}

    {% if stats.blocked|default(0) > 0 %}
    <div style="padding: 15px; background-color: #ffcccc; border-radius: 5px; margin: 20px 0;">
        <p style="margin: 0;">
            <strong>{{ stats.blocked }} adh√©rent(s) avec licence expir√©e</strong> : ces adh√©rents n'√©taient pas dans le fichier FFCAM
            et leur licence a expir√©. Ils ne pourront pas s'inscrire aux sorties tant qu'ils n'auront pas renouvel√© leur adh√©sion.
        </p>
    </div>
    {% endif %}

    <hr style="border: none; border-top: 1px solid #ddd; margin: 30px 0;">

    <p style="color: #666; font-size: 0.9em;">
        Ce rapport est g√©n√©r√© automatiquement apr√®s chaque synchronisation FFCAM.
        En cas de probl√®me, veuillez consulter les logs d√©taill√©s dans l'interface d'administration.
    </p>
{% endblock %}