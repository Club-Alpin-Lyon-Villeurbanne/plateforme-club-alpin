{% extends 'base-light.html.twig' %}

{% block title %}Inscrire un non-adhérent à la sortie{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        #includer-stuff form label {
            font-weight: bold;
            display: block;
        }
    </style>
{% endblock %}

{% block body %}
    <div id="includer-stuff">
        <h1>Inscrire un non-adhérent à cette sortie</h1>
        {{ easy_include('explication-nomades', '') }}

        {{ form_start(form, { attr: { class: 'loading nomad-form' } }) }}

        <hr>

        <div>
            {{ form_row(form.id_user) }}
            <p class="mini">
                Ceci a pour effet de remplacer les valeurs ci-dessous par un nomade ajouté antérieurement.<br>
                Seules certaines informations seront modifiables : date de naissance, e-mail, téléphone et téléphone de secours.
            </p>
        </div>

        <hr>

        <div class="tiers clear">
            {{ form_row(form.cafnum) }}
        </div>

        <div class="tiers clear">
            {{ form_row(form.lastname) }}
        </div>

        <div class="tiers">
            {{ form_row(form.firstname) }}
        </div>

        <div class="tiers">
            {{ form_row(form.birthdate) }}
        </div>

        <div class="tiers clear">
            {{ form_row(form.email) }}
        </div>

        <div class="tiers">
            {{ form_row(form.tel) }}
        </div>

        <div class="tiers">
            {{ form_row(form.tel2) }}
        </div>

        <br style="clear:both">
        <br>

        <button type="submit" class="biglink">
            <span class="bleucaf">&gt;</span>
            INSCRIRE CE NON-ADHÉRENT À MA SORTIE
        </button>

        {{ form_end(form) }}
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const prefilled = [];

            {% for nomad in nomads %}
                {% set birthdate = '' %}
                {% if nomad.birthday is not same as ('') and nomad.birthday is not same as (null) %}
                    {% set birthdate = nomad.birthday|date('d/m/Y') %}
                {% endif %}
                prefilled['{{ nomad.id }}'] = {
                    'birthday_user': '{{ birthdate }}',
                    'cafnum_user': '{{ nomad.cafnum }}',
                    'firstname_user': '{{ nomad.firstname }}',
                    'lastname_user': '{{ nomad.lastname }}',
                    'tel_user': '{{ nomad.tel }}',
                    'tel2_user': '{{ nomad.tel2 }}',
                    'email_user': '{{ nomad.email }}'
                };
            {% endfor %}

            const select = document.getElementById('nomade_id_user');
            if (!select) return;

            select.addEventListener('change', function () {
                const id_user = parseInt(this.value, 10);
                const tmpPrefilled = prefilled[id_user];

                if (id_user > 0 && tmpPrefilled) {
                    document.getElementById('nomade_birthdate').value = tmpPrefilled.birthday_user;

                    document.getElementById('nomade_cafnum').value = tmpPrefilled.cafnum_user;
                    document.getElementById('nomade_cafnum').setAttribute('readonly', 'readonly');

                    document.getElementById('nomade_firstname').value = tmpPrefilled.firstname_user;
                    document.getElementById('nomade_firstname').setAttribute('readonly', 'readonly');

                    document.getElementById('nomade_lastname').value = tmpPrefilled.lastname_user;
                    document.getElementById('nomade_lastname').setAttribute('readonly', 'readonly');

                    document.getElementById('nomade_tel').value = tmpPrefilled.tel_user;

                    document.getElementById('nomade_tel2').value = tmpPrefilled.tel2_user;

                    document.getElementById('nomade_email').value = tmpPrefilled.email_user;
                } else {
                    document.querySelectorAll('#includer-stuff input').forEach(input => {
                        input.value = '';
                        input.removeAttribute('readonly');
                    });
                }
            });
        });
    </script>
{% endblock %}