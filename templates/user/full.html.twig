{% extends 'base.html.twig' %}

{% block title %}Fiche adhérent{% endblock %}

{% block body %}
    {% import 'macros/user-rights.html.twig' as right_macro %}
    {% import 'macros/user-info.html.twig' as info_macro %}
    {% import 'macros/contact-form.html.twig' as contact_macro %}
    {% import 'macros/taux-presence.html.twig' as taux_macro %}
    {% import 'macros/user-content.html.twig' as content_macro %}
<div style="padding:20px">
    {% if app.user %}
        <!-- AVATAR-->
        <img src="{{ media_thumbnail(user.profilePicture, 'pic_profile_thumbnail') }}" alt="Photo de profil" title="{{ user.nickname }}" style="float:left; width:35%; box-shadow: 0 0 12px -5px gray; border: 1px solid white;" />
        <div style="float:right; width:62%">

            <!-- contacter -->
            <a href="javascript:void(0)" title="Utiliser le formulaire de contact pour écrire un message à cet adhérent" class="nice2" style="float:right" onclick="$('#trigger-userinfo, #trigger-usercontact').slideToggle()">
                <img src="/img/base/email.png" alt="" title="" /> &nbsp; &nbsp; Contacter
            </a>

            <!-- nick -->
            <h1 style="padding:13px 0 0 0">
                {% if allowed('user_read_limited') %}
                    {{ user.fullName }} ({{ user.nickname }})
                {% else %}
                    {{ user.nickname }}
                {% endif %}
            </h1>
            <br style="clear:left;" />

            <!-- formulaire de contact -->
            {{ contact_macro.contact_form(form, style) }}

            <!-- statuts -->
            {{ right_macro.user_rights(club_roles, comm_roles) }}

            <!-- infos persos-->
            {{ info_macro.user_info(user, 'full') }}
        </div>
        <br style="clear:both" />
        <hr  />

        {% if afficher_competences %}
        <h2 id="user-skills">Ses compétences :</h2>
        {{ easy_include('full-profile-skills', '')}}

        <p class="bold">Légende :</p>
        <div class="groupe-comp">Groupes de compétences</div>
        <div class="niveau-pratique">Niveaux de pratique</div>
        <div class="formation-generale">Formations générales</div>

        <div class="wide-table-container integrated-table-container profile-block">
            <table class="wide-table table-striped">
                <thead>
                    <tr>
                        <th>Commission</th>
                        <th>Non attribuée</th>
                        {% for commission in commissions %}
                            <th>{{ commission.title }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for groupe in groupes_competences %}
                        <tr>
                            <td class="groupe-comp">
                                {{ groupe.intitule }}
                            </td>
                            <td>{{ date_competence_user(user, groupe, null) }}</td>
                            {% for commission in commissions %}
                                <td>{{ date_competence_user(user, groupe, commission) }}</td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                    {% for niveau in niveaux %}
                        <tr>
                            <td class="niveau-pratique">
                                {{ niveau.libelle }}
                            </td>
                            <td></td>
                            {% for commission in commissions %}
                                <td>{{ date_niveau_user(user, niveau, commission) }}</td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                    <tr>
                        <td class="formation-generale">UFCA (STG-UFFG10)</td>
                        <td>{{ date_formation_user(user, 'STG-UFFG10') }}</td>
                        {% for commission in commissions %}
                            <td></td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td class="formation-generale">PSC1 (STG-PSC1)</td>
                        <td>{{ date_formation_user(user, 'STG-PSC1') }}</td>
                        {% for commission in commissions %}
                            <td></td>
                        {% endfor %}
                    </tr>
                </tbody>
            </table>
        </div>

        <p class="mini" style="margin-top: 10px; color: #666;">
            ⚠️ <strong>Phase de test :</strong> Cet affichage des compétences est expérimental.
            Si vous constatez des erreurs, <a href="https://forms.clickup.com/42653954/f/18np82-775/1BKP6TIKU0RIYXCRWE" target="_blank" rel="noopener noreferrer" style="color: #0066cc;">signalez-les nous via ce formulaire</a>.
        </p>

        <br style="clear:both" />
        <hr  />
        {% endif %}

        {% if allowed('user_read_private') or app.user is same as (user) %}
            <hr  />

            {{ taux_macro.taux_presence(user, fiabilite, nb_absences, total_sorties) }}

            {{ content_macro.user_content(user, nb_articles, user_articles, nb_events, user_events, 'full') }}
        {% endif %}
    {% else %}
        <p class="erreur">Vous devez être connecté pour accéder à cette page.</p>
    {% endif %}
</div>
{% endblock %}
